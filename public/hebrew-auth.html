<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VocabQuest - ×œ××™×“×ª ×©×¤×•×ª ×“×¨×š ××©×—×§</title>
  <style>
    :root {
      /* Professional Color Palette */
      --primary: #6366F1;      /* Indigo */
      --secondary: #8B5CF6;    /* Purple */
      --accent: #06B6D4;       /* Cyan */
      --error: #DF3F40;        /* Red */
      --success: #10B981;      /* Green */
      --warning: #F59E0B;      /* Amber */
      
      /* Neutral Colors */
      --white: #FFFFFF;
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-300: #D1D5DB;
      --gray-400: #9CA3AF;
      --gray-500: #6B7280;
      --gray-600: #4B5563;
      --gray-700: #374151;
      --gray-800: #1F2937;
      --gray-900: #111827;
      
      /* Spacing System */
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 20px;
      --spacing-xl: 24px;
      --spacing-2xl: 32px;
      --spacing-3xl: 48px;
      
      /* Shadows & Effects */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      /* Border Radius */
      --radius-sm: 4px;
      --radius-md: 6px;
      --radius-lg: 8px;
      --radius-xl: 12px;
      --radius-2xl: 16px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: 150ms ease-in-out;
      --transition-normal: 250ms ease-in-out;
      --transition-slow: 350ms ease-in-out;
    }

    /* Reset & Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      font-size: 16px;
      line-height: 1.5;
    }

    body {
      font-family: 'Heebo', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
      color: var(--gray-900);
      min-height: 100vh;
      direction: rtl;
    }

    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 500;
      line-height: 1.2;
      margin-bottom: var(--spacing-md);
    }

    h1 { font-size: 2rem; }
    h2 { font-size: 1.75rem; }
    h3 { font-size: 1.5rem; }
    h4 { font-size: 1.25rem; }
    h5 { font-size: 1.125rem; }
    h6 { font-size: 1rem; }

    p {
      font-weight: 400;
      margin-bottom: var(--spacing-md);
      color: var(--gray-600);
    }

    /* Navigation */
    .topnav {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--gray-200);
      padding: var(--spacing-lg);
      display: flex;
      justify-content: center;
      align-items: center;
      gap: var(--spacing-md);
      box-shadow: var(--shadow-sm);
    }

    .nav-button {
      background: var(--gray-100);
      color: var(--gray-700);
      border: 1px solid var(--gray-200);
      padding: var(--spacing-md) var(--spacing-xl);
      border-radius: var(--radius-full);
      font-weight: 500;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .nav-button:hover {
      background: var(--gray-200);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .nav-button.active {
      background: var(--primary);
      color: var(--white);
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .nav-button.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: translateX(-100%);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      100% { transform: translateX(100%); }
    }

    /* Main Layout */
    main {
      min-height: calc(100vh - 80px);
      padding: var(--spacing-lg);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page {
      display: none;
      width: 100%;
      max-width: 480px;
      animation: fadeInUp 0.5s ease-out;
    }

    .page.active {
      display: block;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Card Component */
    .card {
      background: var(--white);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
      padding: var(--spacing-3xl);
      border: 1px solid var(--gray-200);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
    }

    .card-header {
      text-align: center;
      margin-bottom: var(--spacing-2xl);
    }

    .card-header h1 {
      color: var(--gray-900);
      margin-bottom: var(--spacing-sm);
    }

    .card-header p {
      color: var(--gray-500);
      font-size: 0.875rem;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: var(--spacing-xl);
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: var(--gray-700);
      margin-bottom: var(--spacing-sm);
      font-size: 0.875rem;
    }

    .form-input {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-lg);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-lg);
      font-size: 1rem;
      transition: all var(--transition-normal);
      background: var(--white);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      transform: translateY(-1px);
    }

    .form-input.error {
      border-color: var(--error);
      box-shadow: 0 0 0 3px rgba(223, 63, 64, 0.1);
    }

    .form-input.success {
      border-color: var(--success);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .form-hint {
      font-size: 0.75rem;
      color: var(--gray-500);
      margin-top: var(--spacing-xs);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .form-hint::before {
      content: 'ğŸ’¡';
      font-size: 0.875rem;
    }

    .form-error {
      color: var(--error);
      font-size: 0.75rem;
      margin-top: var(--spacing-xs);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      animation: shake 0.5s ease-in-out;
    }

    .form-error::before {
      content: 'âš ï¸';
      font-size: 0.875rem;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: var(--spacing-lg) var(--spacing-xl);
      border: none;
      border-radius: var(--radius-lg);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-sm);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: var(--white);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-google {
      background: var(--white);
      color: var(--gray-700);
      border: 1px solid var(--gray-300);
      box-shadow: var(--shadow-sm);
    }

    .btn-google:hover {
      background: var(--gray-50);
      border-color: var(--gray-400);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Divider */
    .divider {
      display: flex;
      align-items: center;
      margin: var(--spacing-xl) 0;
      color: var(--gray-400);
      font-size: 0.875rem;
    }

    .divider::before,
    .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--gray-300);
    }

    .divider span {
      padding: 0 var(--spacing-md);
    }

    /* Loading Animation */
    .loading-container {
      text-align: center;
      padding: var(--spacing-3xl);
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid var(--gray-200);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto var(--spacing-xl);
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--gray-200);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin: var(--spacing-lg) 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      border-radius: var(--radius-full);
      transition: width var(--transition-slow);
      animation: progressPulse 2s ease-in-out infinite;
    }

    @keyframes progressPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Footer */
    .footer-note {
      text-align: center;
      font-size: 0.75rem;
      color: var(--gray-500);
      margin-top: var(--spacing-xl);
      padding: var(--spacing-md);
      background: var(--gray-50);
      border-radius: var(--radius-lg);
      border: 1px solid var(--gray-200);
    }

    /* Responsive Design */
    @media (max-width: 640px) {
      .topnav {
        padding: var(--spacing-md);
        gap: var(--spacing-sm);
      }

      .nav-button {
        padding: var(--spacing-sm) var(--spacing-lg);
        font-size: 0.8rem;
      }

      .card {
        padding: var(--spacing-2xl);
        margin: var(--spacing-md);
      }

      main {
        padding: var(--spacing-md);
      }
    }

    @media (max-width: 480px) {
      .nav-button {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 0.75rem;
      }

      .card {
        padding: var(--spacing-xl);
      }

      h1 { font-size: 1.75rem; }
      h2 { font-size: 1.5rem; }
    }

    /* Utility Classes */
    .text-center { text-align: center; }
    .text-left { text-align: left; }
    .text-right { text-align: right; }
    
    .mb-0 { margin-bottom: 0; }
    .mb-1 { margin-bottom: var(--spacing-xs); }
    .mb-2 { margin-bottom: var(--spacing-sm); }
    .mb-3 { margin-bottom: var(--spacing-md); }
    .mb-4 { margin-bottom: var(--spacing-lg); }
    .mb-5 { margin-bottom: var(--spacing-xl); }
    
    .mt-0 { margin-top: 0; }
    .mt-1 { margin-top: var(--spacing-xs); }
    .mt-2 { margin-top: var(--spacing-sm); }
    .mt-3 { margin-top: var(--spacing-md); }
    .mt-4 { margin-top: var(--spacing-lg); }
    .mt-5 { margin-top: var(--spacing-xl); }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="topnav" aria-label="× ×™×•×•×˜ ×¨××©×™">
    <button class="nav-button active" data-target="#login">
      ×”×ª×—×‘×¨×•×ª
    </button>
    <button class="nav-button" data-target="#signup">
      ×”×¨×©××”
    </button>
    <button class="nav-button" data-target="#loading">
      ×˜×¢×™× ×”
    </button>
  </nav>

  <!-- Main Content -->
  <main>
    <!-- Login Page -->
    <section id="login" class="page active" aria-labelledby="login-title">
      <div class="card">
        <div class="card-header">
          <h1 id="login-title">×‘×¨×•×›×” ×”×‘××” ×œ-VocabQuest! ğŸ¯</h1>
          <p>×”×ª×—×‘×¨×™ ×›×“×™ ×œ×”×ª×—×™×œ ××ª ×”××¡×¢ ×©×œ×š ×‘×œ××™×“×ª ×©×¤×•×ª</p>
        </div>

        <form id="login-form" novalidate>
          <div class="form-group">
            <label for="login-email" class="form-label">×›×ª×•×‘×ª ××™×™×œ</label>
            <input 
              id="login-email" 
              type="email" 
              class="form-input" 
              placeholder="×”×–×™× ×™ ××ª ×›×ª×•×‘×ª ×”××™×™×œ ×©×œ×š"
              required 
            />
            <div class="form-error" id="login-email-error" style="display: none;"></div>
          </div>

          <div class="form-group">
            <label for="login-password" class="form-label">×¡×™×¡××”</label>
            <input 
              id="login-password" 
              type="password" 
              class="form-input" 
              placeholder="×”×–×™× ×™ ××ª ×”×¡×™×¡××” ×©×œ×š"
              required 
            />
            <div class="form-error" id="login-password-error" style="display: none;"></div>
          </div>

          <button type="submit" class="btn btn-primary">
            ×”×ª×—×‘×¨×™ ×¢×›×©×™×•
          </button>
        </form>

        <div class="divider">
          <span>××•</span>
        </div>

        <button type="button" class="btn btn-google" id="google-login">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
            <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
            <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
            <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
          </svg>
          ×”×ª×—×‘×¨×™ ×¢× Google
        </button>

        <div class="footer-note">
          ××™×Ÿ ×œ×š ×—×©×‘×•×Ÿ? <a href="#" onclick="showPage('#signup')" style="color: var(--primary); text-decoration: underline;">×”×™×¨×©××™ ×¢×›×©×™×•</a>
        </div>
      </div>
    </section>

    <!-- Signup Page -->
    <section id="signup" class="page" aria-labelledby="signup-title">
      <div class="card">
        <div class="card-header">
          <h1 id="signup-title">×”×¦×˜×¨×¤×™ ×œ-VocabQuest! âœ¨</h1>
          <p>×¦×¨×™ ×—×©×‘×•×Ÿ ×—×“×© ×•×”×ª×—×™×œ×™ ××ª ×”××¡×¢ ×©×œ×š</p>
        </div>

        <form id="signup-form" novalidate>
          <div class="form-group">
            <label for="signup-name" class="form-label">×©× ××œ×</label>
            <input 
              id="signup-name" 
              type="text" 
              class="form-input" 
              placeholder="×”×–×™× ×™ ××ª ×”×©× ×”××œ× ×©×œ×š"
              required 
            />
            <div class="form-error" id="signup-name-error" style="display: none;"></div>
          </div>

          <div class="form-group">
            <label for="signup-email" class="form-label">×›×ª×•×‘×ª ××™×™×œ</label>
            <input 
              id="signup-email" 
              type="email" 
              class="form-input" 
              placeholder="×”×–×™× ×™ ×›×ª×•×‘×ª ××™×™×œ ×ª×§×™× ×”"
              required 
            />
            <div class="form-hint">×”××™×™×œ ×™×©××© ×œ×”×ª×—×‘×¨×•×ª ×•×œ×©×œ×™×—×ª ×¢×“×›×•× ×™× ×—×©×•×‘×™×</div>
            <div class="form-error" id="signup-email-error" style="display: none;"></div>
          </div>

          <div class="form-group">
            <label for="signup-password" class="form-label">×¡×™×¡××”</label>
            <input 
              id="signup-password" 
              type="password" 
              class="form-input" 
              placeholder="×œ×¤×—×•×ª 8 ×ª×•×•×™×"
              required 
            />
            <div class="form-hint">×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 8 ×ª×•×•×™×, ××•×ª ××—×ª ×•×¡×¤×¨×” ××—×ª</div>
            <div class="form-error" id="signup-password-error" style="display: none;"></div>
          </div>

          <div class="form-group">
            <label for="signup-confirm" class="form-label">××™××•×ª ×¡×™×¡××”</label>
            <input 
              id="signup-confirm" 
              type="password" 
              class="form-input" 
              placeholder="×”×§×œ×“×™ ×©×•×‘ ××ª ×”×¡×™×¡××”"
              required 
            />
            <div class="form-error" id="signup-confirm-error" style="display: none;"></div>
          </div>

          <div class="form-group">
            <label class="checkbox-label" style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer;">
              <input type="checkbox" id="terms-checkbox" required style="width: auto; margin: 0;" />
              <span style="font-size: 0.875rem; color: var(--gray-600);">
                ×× ×™ ××¡×›×™××” ×œ<a href="#" style="color: var(--primary);">×ª× ××™ ×”×©×™××•×©</a> ×•<a href="#" style="color: var(--primary);">××“×™× ×™×•×ª ×”×¤×¨×˜×™×•×ª</a>
              </span>
            </label>
          </div>

          <button type="submit" class="btn btn-primary">
            ×¦×¨×™ ×—×©×‘×•×Ÿ
          </button>
        </form>

        <div class="footer-note">
          ×™×© ×œ×š ×›×‘×¨ ×—×©×‘×•×Ÿ? <a href="#" onclick="showPage('#login')" style="color: var(--primary); text-decoration: underline;">×”×ª×—×‘×¨×™ ×¢×›×©×™×•</a>
        </div>
      </div>
    </section>

    <!-- Loading Page -->
    <section id="loading" class="page" aria-labelledby="loading-title">
      <div class="card">
        <div class="loading-container">
          <div class="spinner"></div>
          <h2 id="loading-title">××›×™× ×™× ×”×›×œ ×‘×©×‘×™×œ×š... ğŸš€</h2>
          <p>×× ×—× ×• ×˜×•×¢× ×™× ××ª ×”××©××‘×™× ×”×“×¨×•×©×™× ×œ×œ××™×“×”</p>
          
          <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
          </div>
          
          <p id="loading-status">××ª×—×™×œ×™×...</p>
        </div>
      </div>
    </section>
  </main>

  <script>
    // Enhanced JavaScript with better UX and error handling
    
    class VocabQuestApp {
          constructor() {
      try {
        this.currentPage = 'login';
        this.pages = document.querySelectorAll('.page');
        this.navButtons = document.querySelectorAll('.nav-button');
        this.forms = {
          login: document.getElementById('login-form'),
          signup: document.getElementById('signup-form')
        };
        
        this.init();
      } catch (error) {
        console.error('Error in VocabQuestApp constructor:', error);
        // Fallback initialization
        this.currentPage = 'login';
        this.pages = [];
        this.navButtons = [];
        this.forms = {};
        this.setupBasicNavigation();
      }
    }

      init() {
        try {
          this.setupNavigation();
          this.setupForms();
          this.setupLoadingSimulation();
          this.showPage(this.currentPage);
        } catch (error) {
          console.error('Error initializing VocabQuest app:', error);
          // Fallback to basic functionality
          this.setupBasicNavigation();
        }
      }

      setupBasicNavigation() {
        try {
          // Basic fallback navigation
          const hash = window.location.hash.replace('#', '') || 'login';
          this.showPage(hash);
        } catch (error) {
          console.error('Error in setupBasicNavigation:', error);
          // Last resort - try to show login page
          try {
            const loginPage = document.getElementById('login');
            if (loginPage && loginPage.classList) {
              loginPage.classList.add('active');
            }
          } catch (fallbackError) {
            console.error('Critical error - cannot show any page:', fallbackError);
          }
        }
      }

      setupNavigation() {
        try {
          this.navButtons.forEach(button => {
            if (button && button.dataset.target) {
              button.addEventListener('click', (e) => {
                e.preventDefault();
                const target = button.dataset.target.replace('#', '');
                this.showPage(target);
              });
            }
          });
        } catch (error) {
          console.error('Error setting up navigation:', error);
        }
      }

      showPage(pageId) {
        // Validate pageId
        if (!pageId || typeof pageId !== 'string') {
          console.warn('Invalid pageId:', pageId);
          pageId = 'login';
        }

        // Sanitize pageId to prevent XSS
        pageId = pageId.replace(/[^a-zA-Z0-9-]/g, '');

        // Hide all pages
        this.pages.forEach(page => {
          if (page && page.classList) {
            page.classList.remove('active');
          }
        });

        // Show target page
        const targetPage = document.getElementById(pageId);
        if (targetPage && targetPage.classList) {
          targetPage.classList.add('active');
          this.currentPage = pageId;
        } else {
          console.warn(`Page with id '${pageId}' not found, falling back to login`);
          pageId = 'login';
          const fallbackPage = document.getElementById(pageId);
          if (fallbackPage && fallbackPage.classList) {
            fallbackPage.classList.add('active');
            this.currentPage = pageId;
          }
        }

        // Update navigation
        this.navButtons.forEach(button => {
          if (button && button.dataset.target) {
            button.classList.toggle('active', button.dataset.target === `#${pageId}`);
          }
        });

        // Update URL hash
        try {
          if (window.location.hash !== `#${pageId}`) {
            window.location.hash = `#${pageId}`;
          }
        } catch (error) {
          console.warn('Could not update URL hash:', error);
        }
      }

      setupForms() {
        try {
          // Login form
          if (this.forms.login) {
            this.forms.login.addEventListener('submit', (e) => {
              e.preventDefault();
              this.handleLogin();
            });
          }

          // Signup form
          if (this.forms.signup) {
            this.forms.signup.addEventListener('submit', (e) => {
              e.preventDefault();
              this.handleSignup();
            });
          }

          // Real-time validation
          this.setupRealTimeValidation();
        } catch (error) {
          console.error('Error setting up forms:', error);
        }
      }

      setupRealTimeValidation() {
        try {
          // Email validation
          const emailInputs = document.querySelectorAll('input[type="email"]');
          emailInputs.forEach(input => {
            if (input) {
              input.addEventListener('blur', () => this.validateEmail(input));
              input.addEventListener('input', () => this.clearError(input));
            }
          });

          // Password validation
          const passwordInputs = document.querySelectorAll('input[type="password"]');
          passwordInputs.forEach(input => {
            if (input) {
              input.addEventListener('blur', () => this.validatePassword(input));
              input.addEventListener('input', () => this.clearError(input));
            }
          });

          // Name validation
          const nameInput = document.getElementById('signup-name');
          if (nameInput) {
            nameInput.addEventListener('blur', () => this.validateName(nameInput));
            nameInput.addEventListener('input', () => this.clearError(nameInput));
          }
        } catch (error) {
          console.error('Error setting up real-time validation:', error);
        }
      }

      validateEmail(input) {
        if (!input) return false;
        
        const email = input.value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
        
        if (!email) {
          this.showError(input, '×›×ª×•×‘×ª ××™×™×œ ×”×™× ×©×“×” ×—×•×‘×”');
          return false;
        }
        
        if (!emailRegex.test(email)) {
          this.showError(input, '×›×ª×•×‘×ª ××™×™×œ ×œ× ×ª×§×™× ×”');
          return false;
        }

        this.showSuccess(input);
        return true;
      }

      validatePassword(input) {
        if (!input) return false;
        
        const password = input.value;
        
        if (!password) {
          this.showError(input, '×¡×™×¡××” ×”×™× ×©×“×” ×—×•×‘×”');
          return false;
        }
        
        if (password.length < 8) {
          this.showError(input, '×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 8 ×ª×•×•×™×');
          return false;
        }
        
        if (!/[A-Za-z]/.test(password) || !/\d/.test(password)) {
          this.showError(input, '×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ××•×ª ××—×ª ×•×¡×¤×¨×” ××—×ª');
          return false;
        }

        this.showSuccess(input);
        return true;
      }

      validateName(input) {
        if (!input) return false;
        
        const name = input.value.trim();
        
        if (!name) {
          this.showError(input, '×©× ××œ× ×”×•× ×©×“×” ×—×•×‘×”');
          return false;
        }
        
        if (name.length < 2) {
          this.showError(input, '×”×©× ×—×™×™×‘ ×œ×”×›×™×œ ×œ×¤×—×•×ª 2 ×ª×•×•×™×');
          return false;
        }

        this.showSuccess(input);
        return true;
      }

      showError(input, message) {
        if (!input) return;
        
        input.classList.add('error');
        input.classList.remove('success');
        
        const errorElement = this.getErrorElement(input);
        if (errorElement) {
          errorElement.textContent = message;
          errorElement.style.display = 'block';
        }
      }

      showSuccess(input) {
        if (!input) return;
        
        input.classList.remove('error');
        input.classList.add('success');
        
        const errorElement = this.getErrorElement(input);
        if (errorElement) {
          errorElement.style.display = 'none';
        }
      }

      clearError(input) {
        if (!input) return;
        
        input.classList.remove('error', 'success');
        
        const errorElement = this.getErrorElement(input);
        if (errorElement) {
          errorElement.style.display = 'none';
        }
      }

      getErrorElement(input) {
        if (!input || !input.id) return null;
        
        const inputId = input.id;
        if (inputId.includes('email')) {
          return document.getElementById(inputId.replace('email', 'email-error'));
        } else if (inputId.includes('password')) {
          return document.getElementById(inputId.replace('password', 'password-error'));
        } else if (inputId.includes('name')) {
          return document.getElementById(inputId.replace('name', 'name-error'));
        } else if (inputId.includes('confirm')) {
          return document.getElementById(inputId.replace('confirm', 'confirm-error'));
        }
        return null;
      }

      async handleLogin() {
        try {
          const email = document.getElementById('login-email');
          const password = document.getElementById('login-password');
          
          if (!email || !password) {
            console.error('Login form elements not found');
            this.showErrorMessage('×©×’×™××” ×‘×˜×•×¤×¡ ×”×”×ª×—×‘×¨×•×ª');
            return;
          }
          
          // Validate
          const isEmailValid = this.validateEmail(email);
          const isPasswordValid = this.validatePassword(password);
          
          if (!isEmailValid || !isPasswordValid) {
            return;
          }

          // Simulate login
          if (this.forms.login) {
            this.showLoadingState(this.forms.login);
          }
          
          try {
            await this.simulateApiCall(2000);
            this.showSuccessMessage('×”×ª×—×‘×¨×•×ª ×”×•×©×œ××” ×‘×”×¦×œ×—×”! ğŸ‰');
            setTimeout(() => {
              this.showPage('loading');
            }, 1500);
          } catch (error) {
            this.showErrorMessage('×©×’×™××” ×‘×”×ª×—×‘×¨×•×ª. × ×¡×™ ×©×•×‘.');
          } finally {
            if (this.forms.login) {
              this.hideLoadingState(this.forms.login);
            }
          }
        } catch (error) {
          console.error('Error in handleLogin:', error);
          this.showErrorMessage('×©×’×™××” ×œ× ×¦×¤×•×™×” ×‘×”×ª×—×‘×¨×•×ª');
        }
      }

      async handleSignup() {
        try {
          const name = document.getElementById('signup-name');
          const email = document.getElementById('signup-email');
          const password = document.getElementById('signup-password');
          const confirm = document.getElementById('signup-confirm');
          const terms = document.getElementById('terms-checkbox');
          
          if (!name || !email || !password || !confirm || !terms) {
            console.error('Signup form elements not found');
            this.showErrorMessage('×©×’×™××” ×‘×˜×•×¤×¡ ×”×”×¨×©××”');
            return;
          }
          
          // Validate all fields
          const isNameValid = this.validateName(name);
          const isEmailValid = this.validateEmail(email);
          const isPasswordValid = this.validatePassword(password);
          const isConfirmValid = password.value === confirm.value;
          const isTermsAccepted = terms.checked;
          
          if (!isConfirmValid) {
            this.showError(confirm, '×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª');
            return;
          }
          
          if (!isTermsAccepted) {
            this.showErrorMessage('×™×© ×œ×§×‘×œ ××ª ×ª× ××™ ×”×©×™××•×© ×•××“×™× ×™×•×ª ×”×¤×¨×˜×™×•×ª');
            return;
          }
          
          if (!isNameValid || !isEmailValid || !isPasswordValid || !isConfirmValid) {
            return;
          }

          // Simulate signup
          if (this.forms.signup) {
            this.showLoadingState(this.forms.signup);
          }
          
          try {
            await this.simulateApiCall(2500);
            this.showSuccessMessage('×”×¨×©××” ×”×•×©×œ××” ×‘×”×¦×œ×—×”! ğŸ‰');
            setTimeout(() => {
              this.showPage('login');
            }, 1500);
          } catch (error) {
            this.showErrorMessage('×©×’×™××” ×‘×”×¨×©××”. × ×¡×™ ×©×•×‘.');
          } finally {
            if (this.forms.signup) {
              this.hideLoadingState(this.forms.signup);
            }
          }
        } catch (error) {
          console.error('Error in handleSignup:', error);
          this.showErrorMessage('×©×’×™××” ×œ× ×¦×¤×•×™×” ×‘×”×¨×©××”');
        }
      }

      showLoadingState(form) {
        if (!form) return;
        
        const submitButton = form.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; border-width: 2px; margin: 0;"></div> ×˜×•×¢×Ÿ...';
        }
      }

      hideLoadingState(form) {
        if (!form) return;
        
        const submitButton = form.querySelector('button[type="submit"]');
        if (submitButton) {
          submitButton.disabled = false;
          
          if (form.id === 'login-form') {
            submitButton.textContent = '×”×ª×—×‘×¨×™ ×¢×›×©×™×•';
          } else {
            submitButton.textContent = '×¦×¨×™ ×—×©×‘×•×Ÿ';
          }
        }
      }

      async simulateApiCall(delay) {
        return new Promise((resolve, reject) => {
          const validDelay = typeof delay === 'number' && delay > 0 ? delay : 1000;
          
          setTimeout(() => {
            if (Math.random() > 0.1) { // 90% success rate
              resolve();
            } else {
              reject(new Error('Network error'));
            }
          }, validDelay);
        });
      }

      showSuccessMessage(message) {
        if (message) {
          this.showToast(message, 'success');
        }
      }

      showErrorMessage(message) {
        if (message) {
          this.showToast(message, 'error');
        }
      }

      showToast(message, type) {
        if (!message) return;
        
        // Create toast element
        const toast = document.createElement('div');
        const getBackgroundColor = (type) => {
          if (!type || typeof type !== 'string') {
            type = 'info';
          }
          
          switch(type) {
            case 'success': return 'var(--success)';
            case 'error': return 'var(--error)';
            case 'warning': return 'var(--warning)';
            case 'info': return 'var(--primary)';
            default: return 'var(--primary)';
          }
        };

        try {
          toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${getBackgroundColor(type)};
            color: white;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform var(--transition-normal);
            max-width: 300px;
            font-weight: 500;
            cursor: pointer;
          `;
        } catch (error) {
          console.error('Error setting toast styles:', error);
          return;
        }
        // Sanitize message to prevent XSS
        const sanitizedMessage = message.replace(/[<>]/g, '');
        try {
          toast.textContent = sanitizedMessage;
        } catch (error) {
          console.error('Error setting toast text:', error);
          return;
        }
        
        try {
          document.body.appendChild(toast);
        } catch (error) {
          console.error('Error adding toast to body:', error);
          return;
        }
        
        // Animate in
        setTimeout(() => {
          try {
            if (toast && toast.style) {
              toast.style.transform = 'translateX(0)';
            }
          } catch (error) {
            console.warn('Error animating toast in:', error);
          }
        }, 100);
        
        // Remove after 3 seconds
        const removeToast = setTimeout(() => {
          try {
            if (toast && toast.style) {
              toast.style.transform = 'translateX(100%)';
              setTimeout(() => {
                try {
                  if (document.body.contains(toast)) {
                    document.body.removeChild(toast);
                  }
                } catch (removeError) {
                  console.warn('Error removing toast element:', removeError);
                }
              }, 300);
            }
          } catch (error) {
            console.warn('Error animating toast out:', error);
          }
        }, 3000);

        // Cleanup function
        try {
          if (toast && toast.addEventListener) {
            toast.addEventListener('click', () => {
              clearTimeout(removeToast);
              try {
                if (document.body.contains(toast)) {
                  document.body.removeChild(toast);
                }
              } catch (error) {
                console.warn('Error removing toast on click:', error);
              }
            });
          }
        } catch (error) {
          console.warn('Error adding click listener to toast:', error);
        }
      }

      setupLoadingSimulation() {
        try {
          const loadingPage = document.getElementById('loading');
          if (loadingPage) {
            const progressFill = document.getElementById('progress-fill');
            const loadingStatus = document.getElementById('loading-status');
            
            if (!progressFill || !loadingStatus) {
              console.warn('Loading elements not found');
              return;
            }
            
            const statuses = [
              '××›×™× ×™× ××ª ×”××©××‘×™×...',
              '×˜×•×¢× ×™× ××ª ×”×ª×•×›×Ÿ...',
              '×××ª×—×œ×™× ××ª ×”××¢×¨×›×ª...',
              '×›××¢×˜ ×¡×™×™×× ×•...',
              '××•×›×Ÿ! ğŸ‰'
            ];
            
            let currentStep = 0;
            const interval = setInterval(() => {
              if (currentStep < statuses.length) {
                const progress = ((currentStep + 1) / statuses.length) * 100;
                progressFill.style.width = `${progress}%`;
                loadingStatus.textContent = statuses[currentStep];
                currentStep++;
              } else {
                clearInterval(interval);
                setTimeout(() => {
                  this.showPage('login');
                }, 1000);
              }
            }, 800);
          }
        } catch (error) {
          console.error('Error in setupLoadingSimulation:', error);
        }
      }
    }

    // Google login handler
    const googleLoginButton = document.getElementById('google-login');
    if (googleLoginButton) {
      googleLoginButton.addEventListener('click', () => {
        try {
          // Simulate Google OAuth
          const app = window.vocabQuestApp;
          if (app && app.showToast) {
            app.showToast('ğŸ”Œ ×›××Ÿ ×™×©×ª×œ×‘ OAuth ×©×œ Google â€” ×–×”×• ××•×§××¤Ö¼ ×¢×™×¦×•×‘×™', 'info');
          }
        } catch (error) {
          console.error('Error in Google login handler:', error);
        }
      });
    }

    // Initialize app when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      try {
        window.vocabQuestApp = new VocabQuestApp();
        
        // Handle hash changes
        window.addEventListener('hashchange', () => {
          try {
            const hash = window.location.hash.replace('#', '') || 'login';
            if (window.vocabQuestApp && window.vocabQuestApp.showPage) {
              window.vocabQuestApp.showPage(hash);
            }
          } catch (error) {
            console.error('Error handling hash change:', error);
          }
        });
        
        // Set initial page from hash
        const initialHash = window.location.hash.replace('#', '') || 'login';
        if (window.vocabQuestApp && window.vocabQuestApp.showPage) {
          window.vocabQuestApp.showPage(initialHash);
        }
      } catch (error) {
        console.error('Error initializing VocabQuest app:', error);
        // Fallback - try to show login page directly
        try {
          const loginPage = document.getElementById('login');
          if (loginPage && loginPage.classList) {
            loginPage.classList.add('active');
          }
        } catch (fallbackError) {
          console.error('Critical error - cannot show any page:', fallbackError);
        }
      }
    });

    // Fallback initialization for older browsers
    if (document.readyState === 'loading') {
      // Document still loading, wait for DOMContentLoaded
    } else {
      // Document already loaded, initialize immediately
      try {
        if (!window.vocabQuestApp) {
          window.vocabQuestApp = new VocabQuestApp();
        }
      } catch (error) {
        console.error('Error in fallback initialization:', error);
        // Last resort - show login page directly
        try {
          const loginPage = document.getElementById('login');
          if (loginPage && loginPage.classList) {
            loginPage.classList.add('active');
          }
        } catch (fallbackError) {
          console.error('Critical error in fallback initialization:', fallbackError);
        }
      }
    }

    // Error boundary for unhandled errors
    window.addEventListener('error', (event) => {
      console.error('Unhandled error:', event.error);
      // Try to show error message to user
      try {
        if (window.vocabQuestApp && window.vocabQuestApp.showErrorMessage) {
          window.vocabQuestApp.showErrorMessage('×©×’×™××” ×œ× ×¦×¤×•×™×” ×”×ª×¨×—×©×”. ×× × ×¨×¢× × ×™ ××ª ×”×“×£.');
        }
      } catch (error) {
        console.error('Error showing error message:', error);
      }
    });

    // Promise rejection handler
    window.addEventListener('unhandledrejection', (event) => {
      console.error('Unhandled promise rejection:', event.reason);
      // Try to show error message to user
      try {
        if (window.vocabQuestApp && window.vocabQuestApp.showErrorMessage) {
          window.vocabQuestApp.showErrorMessage('×©×’×™××” ×œ× ×¦×¤×•×™×” ×”×ª×¨×—×©×”. ×× × ×¨×¢× × ×™ ××ª ×”×“×£.');
        }
      } catch (error) {
        console.error('Error showing error message:', error);
      }
    });

    // Performance monitoring
    if ('performance' in window && 'timing' in performance) {
      window.addEventListener('load', () => {
        try {
          const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
          console.log(`Page loaded in ${loadTime}ms`);
        } catch (error) {
          console.warn('Could not measure page load time:', error);
        }
      });
    }

    // Accessibility improvements
    document.addEventListener('keydown', (event) => {
      try {
        // Escape key to close any open modals or toasts
        if (event.key === 'Escape') {
          try {
            const toasts = document.querySelectorAll('[style*="transform: translateX(0)"]');
            if (toasts.length > 0) {
              toasts.forEach(toast => {
                try {
                  if (toast && document.body.contains(toast)) {
                    document.body.removeChild(toast);
                  }
                } catch (error) {
                  console.warn('Error removing toast on escape:', error);
                }
              });
            }
          } catch (error) {
            console.warn('Error finding toasts on escape:', error);
          }
        }

        // Enter key to submit forms when focused on submit buttons
        if (event.key === 'Enter') {
          try {
            const activeElement = document.activeElement;
            if (activeElement && activeElement.type === 'submit') {
              event.preventDefault();
              activeElement.click();
            }
          } catch (error) {
            console.warn('Error handling enter key:', error);
          }
        }

        // Tab key navigation for better accessibility
        if (event.key === 'Tab') {
          try {
            const focusableElements = document.querySelectorAll(
              'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            
            if (focusableElements.length > 0) {
              const firstElement = focusableElements[0];
              const lastElement = focusableElements[focusableElements.length - 1];

              if (event.shiftKey && document.activeElement === firstElement) {
                event.preventDefault();
                lastElement.focus();
              } else if (!event.shiftKey && document.activeElement === lastElement) {
                event.preventDefault();
                firstElement.focus();
              }
            }
          } catch (error) {
            console.warn('Error in tab navigation:', error);
          }
        }
      } catch (error) {
        console.warn('Error in keyboard handler:', error);
      }
    });

    // Global function for navigation
    function showPage(pageId) {
      try {
        if (window.vocabQuestApp && window.vocabQuestApp.showPage) {
          window.vocabQuestApp.showPage(pageId);
        } else {
          console.warn('VocabQuest app not initialized');
          // Fallback - try to show page directly
          try {
            if (pageId && typeof pageId === 'string') {
              const targetPage = document.getElementById(pageId);
              if (targetPage && targetPage.classList) {
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                  if (page && page.classList) {
                    page.classList.remove('active');
                  }
                });
                // Show target page
                targetPage.classList.add('active');
                
                // Update navigation buttons
                document.querySelectorAll('.nav-button').forEach(button => {
                  if (button && button.dataset && button.dataset.target) {
                    button.classList.toggle('active', button.dataset.target === `#${pageId}`);
                  }
                });
                
                // Update URL hash
                try {
                  if (window.location.hash !== `#${pageId}`) {
                    window.location.hash = `#${pageId}`;
                  }
                } catch (hashError) {
                  console.warn('Could not update URL hash:', hashError);
                }
              }
            }
          } catch (fallbackError) {
            console.error('Error in fallback page navigation:', fallbackError);
          }
        }
      } catch (error) {
        console.error('Error in global showPage function:', error);
      }
    }

    // Add some additional utility functions
    window.VocabQuestUtils = {
      // Show a simple message to the user
      showMessage: function(message, type = 'info') {
        try {
          if (window.vocabQuestApp && window.vocabQuestApp.showToast) {
            window.vocabQuestApp.showToast(message, type);
          } else {
            // Fallback - simple alert
            alert(message);
          }
        } catch (error) {
          console.error('Error showing message:', error);
          alert(message);
        }
      },
      
      // Navigate to a specific page
      navigateTo: function(pageId) {
        showPage(pageId);
      },
      
      // Get current page
      getCurrentPage: function() {
        try {
          if (window.vocabQuestApp && window.vocabQuestApp.currentPage) {
            return window.vocabQuestApp.currentPage;
          } else {
            // Fallback - check active page
            const activePage = document.querySelector('.page.active');
            return activePage ? activePage.id : 'login';
          }
        } catch (error) {
          console.error('Error getting current page:', error);
          return 'login';
        }
      }
    };
  </script>
</body>
</html>